<div class="flights-container">
  <button class="back-link" (click)="goBack()">Back to Home</button>

  <header class="header-section">
    <div>
      <h2>ğŸ›¬ Ground Logistics & Catering</h2>
      <p>{{ filteredFlights.length }} active turnarounds</p>
    </div>

    <div class="controls-group">
      <div class="filter-toggle" (click)="toggleHideDeparted()" [class.active]="hideDeparted">
        Hide Departed
      </div>
      <div class="date-display">
        <span class="label">System Date</span>
        <span class="value">{{ today | date: 'fullDate' }}</span>
        <span class="time">{{ today | date: 'shortTime' }}</span>
      </div>
    </div>
  </header>

  <div class="table-wrapper">
    <table class="modern-table">
      <thead>
        <tr>
          <th>Airliner</th>
          <th>Plane Type</th>
          <th>Crew</th>
          <th>Seats</th>
          <th>Arrival</th>
          <th>Departure</th>
          <th>Time</th>
          <th>Catering</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let flight of filteredFlights" [class.row-departed]="isDeparted(flight)">
          <td>
            <div class="brand-cell">
              <span class="brand-name">{{ flight.brand }} âœˆï¸</span>
              <div *ngIf="isDeparted(flight)" class="departed-tag">Departed</div>
            </div>
          </td>
          <td>{{ flight.planeType }}</td>
          <td>{{ flight.crewCount }}</td>
          <td>{{ flight.seats }}</td>
          <td>{{ flight.arrivalDate }}</td>
          <td>{{ flight.departureDate }}</td>
          <td>{{ flight.departureTime }}</td>
          <td>
            <span class="status-pill" [ngClass]="flight.foodRequested ? 'status-yes' : 'status-no'">
              {{ flight.foodRequested ? 'ğŸ¥— Requested' : 'âŒ No Service' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <button class="fab-button" (click)="openModal()">â•</button>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="isModalOpen">
  <div class="modal-card">
    <h3>â• Add New Flight</h3>

    <form [formGroup]="flightForm" (ngSubmit)="onSubmit()" class="modal-form">
      <label>Airline</label>
      <select formControlName="brand" required>
        <option value="">Select Airline</option>
        <option *ngFor="let airline of airlines" [value]="airline">{{ airline }}</option>
      </select>

      <label>Plane Type</label>
      <input type="text" formControlName="planeType" placeholder="Boeing 737" required />

      <label>Crew Count</label>
      <input type="number" formControlName="crewCount" min="1" required />

      <label>Seats</label>
      <input type="number" formControlName="seats" min="1" required />

      <!-- Food Requested Checkbox -->
      <div class="form-group">
        <label>
          <input type="checkbox" formControlName="foodRequested" (change)="onFoodToggle()" />
          ğŸ½ï¸ Food Requested
        </label>
      </div>

      <!-- Preferred Food Type -->
      <div class="form-group" *ngIf="flightForm.get('foodRequested')?.value">
        <label>Preferred Food Type</label>
        <select formControlName="preferredFood">
          <option value="" disabled>Select food type</option>
          <option *ngFor="let type of foodTypes" [value]="type">{{ type }}</option>
        </select>
      </div>

      <label>Arrival Date (to local airport)</label>
      <input type="date" formControlName="arrivalDate" (change)="onDateChange()" required />

      <label>Departure Date (from local airport)</label>
      <input
        type="date"
        formControlName="departureDate"
        [min]="minDepartureDate"
        (change)="onDateChange()"
        required
      />

      <label>Departure Time (from local airport)</label>
      <input
        type="time"
        formControlName="departureTime"
        (change)="checkFoodEligibility()"
        required
      />

      <div class="modal-actions">
        <button type="button" (click)="closeModal()">âŒ Cancel</button>
        <button type="submit" [disabled]="flightForm.invalid">ğŸ’¾ Add Flight</button>
      </div>
    </form>
  </div>
</div>
