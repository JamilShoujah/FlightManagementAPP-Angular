<!-- src/app/pages/view-orders/view-orders.html -->

<div class="orders-container">
  <button class="back-link" (click)="router.navigate(['/'])">â† Back to Home</button>

  <div class="tabs">
    <button (click)="activeTab = 'upcoming'" [class.active]="activeTab === 'upcoming'">
      ğŸ†• Upcoming Orders
    </button>
    <button (click)="activeTab = 'previous'" [class.active]="activeTab === 'previous'">
      âœ… Completed Orders
    </button>
  </div>

  <div *ngIf="activeTab === 'upcoming'" class="order-grid">
    <div *ngFor="let flight of upcomingOrders()" class="order-card">
      <div class="header">
        <span>{{ flight.brand }} âœˆï¸ ({{ flight.planeType }})</span>
        <select
          [(ngModel)]="flight.orderInfo.status"
          (ngModelChange)="updateStatus(flight.id, $event)"
        >
          <option value="PENDING">ğŸ•’ PENDING</option>
          <option value="COMPLETE">âœ… COMPLETE</option>
          <option value="DELIVERED">ğŸ“¦ DELIVERED</option>
        </select>
      </div>
      <div class="items">
        <div *ngFor="let item of flight.orderInfo.itemsRequested">
          ğŸ´ {{ getFoodName(item.foodId) }}: {{ item.quantity }}
        </div>
      </div>
      <button (click)="selectFlight(flight.id); showAddModal.set(true)">âœï¸ Edit Order</button>
    </div>
  </div>

  <div *ngIf="activeTab === 'previous'" class="history-table-wrapper">
    <table class="modern-table">
      <thead>
        <tr>
          <th>Flight</th>
          <th>Status</th>
          <th>Items</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let flight of previousOrders()">
          <td>{{ flight.brand }} âœˆï¸ ({{ flight.planeType }})</td>
          <td>
            <span class="status-pill" [ngClass]="flight.orderInfo.status.toLowerCase()">{{
              flight.orderInfo.status
            }}</span>
          </td>
          <td>
            <div *ngFor="let item of flight.orderInfo.itemsRequested">
              ğŸ½ï¸ {{ getFoodName(item.foodId) }}: {{ item.quantity }}
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="modal-overlay" *ngIf="showAddModal()">
    <div class="modal-card">
      <h3>ğŸ“ Edit Order</h3>
      <div *ngFor="let option of FOODOPTIONS">
        <label>{{ option.name }} ({{ option.type }})</label>
        <input type="number" min="0" [(ngModel)]="orderQuantities[option.id]" />
      </div>
      <div class="modal-actions">
        <button (click)="showAddModal.set(false)">âŒ Cancel</button>
        <button (click)="saveOrder(selectedFlightId!)">ğŸ’¾ Save</button>
      </div>
    </div>
  </div>
</div>
