<!-- src/app/pages/view-orders/view-orders.html -->

<div class="orders-container">
  <button class="back-link" (click)="router.navigate(['/'])">‚Üê Back to Home</button>

  <!-- Tabs -->
  <div class="tabs">
    <button (click)="activeTab = 'upcoming'" [class.active]="activeTab === 'upcoming'">
      üÜï Upcoming Orders
    </button>
    <button (click)="activeTab = 'previous'" [class.active]="activeTab === 'previous'">
      ‚úÖ Completed Orders
    </button>
  </div>

  <!-- UPCOMING -->
  <div *ngIf="activeTab === 'upcoming'" class="order-grid">
    <div *ngFor="let flight of upcomingOrders()" class="order-card">
      <!-- Header -->
      <div class="header">
        <div class="flight-info">
          <span class="brand">{{ flight.brand }}</span>
          <span class="plane">‚úàÔ∏è {{ flight.planeType }}</span>
        </div>

        <select
          class="status-select"
          [(ngModel)]="flight.orderInfo.status"
          (ngModelChange)="updateStatus(flight.id, $event)"
        >
          <option value="PENDING">PENDING</option>
          <option value="COMPLETE">COMPLETE</option>
          <option value="DELIVERED">DELIVERED</option>
        </select>
      </div>

      <!-- Items -->
      <div class="items">
        <div class="item" *ngFor="let item of flight.orderInfo.itemsRequested">
          <span>{{ getFoodName(item.foodId) }}</span>
          <span class="qty">√ó {{ item.quantity }}</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="card-actions">
        <button class="secondary" (click)="selectFlight(flight.id); showAddModal.set(true)">
          ‚úèÔ∏è Edit Order
        </button>
      </div>
    </div>
  </div>

  <!-- PREVIOUS -->
  <div *ngIf="activeTab === 'previous'" class="history-table-wrapper">
    <table class="modern-table">
      <thead>
        <tr>
          <th>Flight</th>
          <th>Status</th>
          <th>Items</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let flight of previousOrders()">
          <td>
            <strong>{{ flight.brand }}</strong>
            <div class="sub">{{ flight.planeType }}</div>
          </td>

          <td>
            <span class="status-pill" [ngClass]="flight.orderInfo.status.toLowerCase()">
              {{ flight.orderInfo.status }}
            </span>
          </td>

          <td>
            <div class="history-item" *ngFor="let item of flight.orderInfo.itemsRequested">
              {{ getFoodName(item.foodId) }} √ó {{ item.quantity }}
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" *ngIf="showAddModal()">
    <div class="modal-card">
      <h3>üìù Edit Order</h3>

      <div class="food-row" *ngFor="let option of FOODOPTIONS">
        <label>{{ option.name }}</label>
        <input type="number" min="0" [(ngModel)]="orderQuantities[option.id]" />
      </div>

      <div class="modal-actions">
        <button class="ghost" (click)="showAddModal.set(false)">Cancel</button>
        <button class="primary" (click)="saveOrder(selectedFlightId!)">Save Changes</button>
      </div>
    </div>
  </div>
</div>
